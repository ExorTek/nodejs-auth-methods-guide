sequenceDiagram
    autonumber
    participant A as ğŸ‘¤ Uygulama Sahibi<br/>(Developer)
    participant C as ğŸ–¥ï¸ 3. Parti App<br/>(Client)
    participant U as ğŸ‘¤ KullanÄ±cÄ±
    participant S as ğŸ” Bizim Server<br/>(OAuth Provider)

    rect rgb(30, 30, 60)
        Note over A,S: 1ï¸âƒ£ Client Registration (bir kez)
        A->>S: POST /oauth/clients<br/>{name, redirectUris}
        S-->>A: {client_id, client_secret}<br/>âš ï¸ secret sadece bir kez gÃ¶sterilir
    end

    rect rgb(30, 50, 30)
        Note over C,S: 2ï¸âƒ£ Authorization Flow
        C->>S: GET /oauth/authorize<br/>?response_type=code<br/>&client_id=xxx<br/>&redirect_uri=yyy<br/>&code_challenge=zzz
        Note over S: KullanÄ±cÄ± oturumu kontrol et
        S-->>U: Consent Screen<br/>"Bu uygulama email ve profilinize<br/>eriÅŸmek istiyor. Ä°zin veriyor musunuz?"
        U->>S: Ä°zin ver âœ…
        S-->>C: 302 â†’ redirect_uri?code=abc&state=def
    end

    rect rgb(50, 30, 30)
        Note over C,S: 3ï¸âƒ£ Token Exchange
        C->>S: POST /oauth/token<br/>{code, client_id, client_secret, code_verifier}
        Note over S: Code consume (atomic)<br/>PKCE doÄŸrula<br/>redirect_uri eÅŸleÅŸtir
        S-->>C: {access_token, refresh_token, expires_in}
    end

    rect rgb(40, 40, 60)
        Note over C,S: 4ï¸âƒ£ Resource Access
        C->>S: GET /oauth/userinfo<br/>Authorization: Bearer access_token
        S-->>C: {sub, name, email, picture}
    end
